<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerador de HTMLs</title>
</head>
<body>
  <h1>Gerador de formulários SEI de afastamento docente TCC-IC-UFF</h1>

  <h3>Importante: utilize apenas no Firefox, pois o Chrome pode corromper os documentos durante download.</h3>

  <h3>Passo 1: crie um Novo processo de afastamento no SEI e preencha abaixo: <a href="https://sei.uff.br/" target="_blank">https://sei.uff.br/</a></h3>
  <h3>Passo 2: insira abaixo TODOS os dados solicitados e baixe os 4 formulários gerados para anexar no SEI.</h3>
  <h3>Passo 3: crie manualmente cada um dos formulários no SEI, depois SUBSTITUA o conteúdo (formatação só fica perfeita se usar o Firefox!), e finalmente, LEIA e ASSINE digitalmente.</h3>
  <h3>Importante: esse sistema funciona como PÁGINA ESTÁTICA e NENHUM dado é enviado a servidores externos.</h3>

  <form id="form">

    <label for="NumeroProcessoSEI"><b>NumeroProcessoSEI:</b></label><br>
    <input id="NumeroProcessoSEI"    placeholder="23069.xxxxxx/2024-xx" size="50"><br/>
    <label for="Cargo"><b>Cargo:</b></label><br>
    <input id="Cargo"                placeholder="Professor(a) do Magistério Superior" value="Professor(a) do Magistério Superior" size="50"><br/>
    <label for="LocalOrigem"><b>LocalOrigem:</b></label><br>
    <input id="LocalOrigem"          placeholder="Niterói" value="Niterói" size="50"><br/>
    <label for="DataDaSolicitacaoSEI"><b>DataDaSolicitacaoSEI:</b></label><br>
    <input id="DataDaSolicitacaoSEI" placeholder="19 de agosto de 2024" size="50"><br/>
    <label for="Email"><b>Email:</b></label><br>
    <input id="Email"                placeholder="mail@ic.uff.br" size="50"><br/>
    <label for="Nome"><b>Nome:</b></label><br>
    <input id="Nome"                 placeholder="Nome Completo do Professor" size="50"><br/>
    <label for="SIAPE"><b>SIAPE:</b></label><br>
    <input id="SIAPE"                placeholder="SIAPE do Professor" size="50"><br/>
    <label for="Escolaridade"><b>Escolaridade:</b></label><br>
    <input id="Escolaridade"         placeholder="Doutorado" value="Doutorado" size="50"><br/>
    <label for="DataDeNascimento"><b>DataDeNascimento:</b></label><br>
    <input id="DataDeNascimento"     placeholder="01/01/1970" size="50"><br/>
    <label for="NomeENumeroDoBanco"><b>NomeENumeroDoBanco:</b></label><br>
    <input id="NomeENumeroDoBanco"   placeholder="Banco do Brasil, 001" size="50"><br/>
    <label for="Agencia"><b>Agencia:</b></label><br>
    <input id="Agencia"              placeholder="xxxx" size="50"><br/>
    <label for="ContaCorrente"><b>ContaCorrente:</b></label><br>
    <input id="ContaCorrente"        placeholder="xxxx" size="50"><br/>
    <label for="DV"><b>DV:</b></label><br>
    <input id="DV"                   placeholder="x" size="50"><br/>
    <label for="CPF"><b>CPF:</b></label><br>
    <input id="CPF"                  placeholder="xxx.xxx.xxx-xx" size="50"><br/>
    <label for="RG"><b>RG:</b></label><br>
    <input id="RG"                   placeholder="xxxxxxx" size="50"><br/>
    <label for="OrgaoEmisorRG"><b>OrgaoEmissorRG:</b></label><br>
    <input id="OrgaoEmisorRG"        placeholder="SSP-SP" size="50"><br/>
    <label for="Telefone"><b>Telefone:</b></label><br>
    <input id="Telefone"             placeholder="(21)XXXXX-XXXX" size="50"><br/>
    <label for="Evento"><b>Evento:</b></label><br>
    <input id="Evento"               placeholder="Banca de Concurso Público" size="50"><br/>
    <label for="InstituicaoDestino"><b>InstituicaoDestino:</b></label><br>
    <input id="InstituicaoDestino"   placeholder="Instituição/Universidade de Destino" size="50"><br/>
    <label for="CidadeDestino"><b>CidadeDestino:</b></label><br>
    <input id="CidadeDestino"        placeholder="São Paulo" size="50"><br/>
    <label for="EstadoDestino"><b>EstadoDestino:</b></label><br>
    <input id="EstadoDestino"        placeholder="SP" size="50"><br/>
    <label for="DataInicioEvento"><b>DataInicioEvento:</b></label><br>
    <input id="DataInicioEvento"     placeholder="02/01/2024" size="50"><br/>
    <label for="HoraInicioEvento"><b>HoraInicioEvento:</b></label><br>
    <input id="HoraInicioEvento"     placeholder="9:00" size="50"><br/>
    <label for="DataTerminoEvento"><b>DataTerminoEvento:</b></label><br>
    <input id="DataTerminoEvento"    placeholder="07/01/2024" size="50"><br/>
    <label for="HoraTerminoEvento"><b>HoraTerminoEvento:</b></label><br>
    <input id="HoraTerminoEvento"    placeholder="17:00" size="50"><br/>
    <label for="DataInicioAfastamento"><b>DataInicioAfastamento:</b></label><br>
    <input id="DataInicioAfastamento"         placeholder="01/01/2024" size="50"><br/>
    <label for="DataVoltaEvento"><b>DataVoltaEvento:</b></label><br>
    <input id="DataVoltaEvento"               placeholder="08/01/2024" size="50"><br/>
    <label for="DataTerminoAfastamento"><b>DataTerminoAfastamento:</b></label><br>
    <input id="DataTerminoAfastamento"        placeholder="09/01/2024" size="50"><br/>
    <label for="MeioDeTransporteIda"><b>MeioDeTransporteIda:</b></label><br>
    <input id="MeioDeTransporteIda"           placeholder="Aéreo/Rodoviário" value="Aéreo" size="50"><br/>
    <label for="MeioDeTransporteVolta"><b>MeioDeTransporteVolta:</b></label><br>
    <input id="MeioDeTransporteVolta"         placeholder="Aéreo/Rodoviário" value="Aéreo" size="50"><br/>
    <label for="DescricaoMotivoViagem"><b>DescricaoMotivoViagem:</b></label><br>
    <input id="DescricaoMotivoViagem"         placeholder="Descrição" value="Banca examinadora do concurso público de títulos e provas visando o provimento de 01 (um) cargo de Professor Doutor, junto ao Departamento de ______, na área de conhecimento ______, nos termos do edital nº _____, publicado no D.O.E. ______" size="100"><br/>
    
    <div>
      <label for="NaturezaAfastamento"><b>Natureza do Afastamento:</b></label><br>
      <select id="NaturezaAfastamento" name="NaturezaAfastamento" required>
        <option value="">-- Selecione um caso --</option>
        <option value="CASO_1">
          CASO_1 Com ônus UFF - manutenção do salário e com despesas pagas pela Administração Federal
        </option>
        <option value="CASO_2">
          CASO_2 Com ônus Agência de Fomento - manutenção do salário e com despesas pagas pela Administração Federal
        </option>
        <option value="CASO_3" selected>
          CASO_3 Com ônus limitado - manutenção do salário e com despesas pagas com recursos do próprio requerente
        </option>
        <option value="CASO_4">
          CASO_4 Com ônus limitado - manutenção do salário e com despesas pagas com recursos de Agência de Fomento
        </option>
        <option value="CASO_5">
          CASO_5 Sem ônus - sem salário e sem qualquer despesa paga por órgão da Administração Federal
        </option>
      </select>
    </div>

    <p style="font-size: small; color: gray;">
      Escolha apenas um dos casos acima.  
      Edite o campo <b>Natureza do Afastamento</b> e, se aplicável, o campo <b>Nome do Financiador</b>.
    </p>

    <div>
      <label for="NomeFinanciador"><b>Nome do Financiador:</b></label> (Casos 1, 2 ou 4)<br>
      <input 
        id="NomeFinanciador" 
        name="NomeFinanciador" 
        type="text" 
        placeholder="Preencha apenas nos casos 1, 2 ou 4"
        size="50"
      >
    </div>
    
    <label for="JustificativaDiariasPassagens"><b>JustificativaDiariasPassagens:</b></label><br>
    <input id="JustificativaDiariasPassagens" placeholder="Justificativa" value="O convite dos organizadores do evento para participação do evento incluia a cobertura de custos de passagens e diárias" size="100"><br/>
    <label for="MotivoRenuncia"><b>MotivoRenuncia:</b></label> (que as despesas ...)<br>
    <input id="MotivoRenuncia"                placeholder="Motivo" value="que as despesas (ou passagens) pagas serão cobertas pela instituição que me convidou para participar do evento" size="100"><br/>
    

    <div>
      <label for="TipoAfastamento"><b>Tipo de Afastamento:</b></label><br>
      <select id="TipoAfastamento" name="TipoAfastamento" required>
        <option value="TIPO_1">TIPO_1 Mestrado</option>
        <option value="TIPO_2">TIPO_2 Doutorado</option>
        <option value="TIPO_3">TIPO_3 Pós-Doutorado</option>
        <option value="TIPO_4">TIPO_4 Aperfeiçoamento/Especialização</option>
        <option value="TIPO_5">TIPO_5 Intercâmbio cultural, científico ou tecnológico</option>
        <option value="TIPO_6">TIPO_6 Treinamento em serviço em órgão ou entidade da administração pública direta ou indireta da esfera federal, estadual ou municipal</option>
        <option value="TIPO_7" selected>TIPO_7 Congressos e congêneres</option>
        <option value="TIPO_8">TIPO_8 Outro</option>
        <option value="TIPO_9">TIPO_9 Banca Examinadora</option>
      </select>
    </div>

    <p style="font-size: small; color: gray;">
      Escolha apenas um dos tipos acima.  
      Edite apenas o campo <b>Tipo de Afastamento</b>.  
      Se escolher <b>TIPO_8 Outro</b>, especifique no campo abaixo.
    </p>
    
    <div>
      <label for="Outro"><b>Outro (especifique):</b></label><br>
      <input 
        id="Outro" 
        name="Outro" 
        type="text" 
        placeholder="Somente preencha se escolher 'TIPO_8 Outro'"
        size="50"
      >
    </div>

    <br/><br/>
    
    <button type="submit">Gerar arquivos</button>
  </form>

  <p id="status"></p>

  <script>

// Convert string to ISO-8859-1 bytes manually
function latin1Bytes(str) {
  const arr = new Uint8Array(str.length);
  for (let i = 0; i < str.length; i++) {
    const code = str.charCodeAt(i);
    if (code > 255) {
      throw new Error("Character cannot be represented in ISO-8859-1: " + str[i]);
    }
    arr[i] = code;
  }
  return arr;
}

function replaceBytes(arr, fromStr, toStr) {
  //const from = new TextEncoder("latin1").encode(fromStr); // fromStr as bytes
  //const to = new TextEncoder("latin1").encode(toStr);
  const from = latin1Bytes(fromStr);
  const to = latin1Bytes(toStr);

  const result = new Uint8Array(arr.length - from.length + to.length);
  let ri = 0;

  for (let i = 0; i < arr.length;) {
    let match = true;
    for (let j = 0; j < from.length; j++) {
      if (arr[i + j] !== from[j]) {
        match = false;
        break;
      }
    }

    if (match) {
      result.set(to, ri);
      i += from.length;
      ri += to.length;
    } else {
      result[ri++] = arr[i++];
    }
  }

  return result.buffer;
}

  const templates = ["oform-1.htm", "oform-2.htm", "oform-3.htm", "oform-4.htm"];

document.getElementById("form").addEventListener("submit", async (e) => {
  e.preventDefault();
  document.getElementById("status").innerText = "Processando...";

  let form1Tab1 = document.getElementById("NaturezaAfastamento").value;
  let form1Tab2 = document.getElementById("TipoAfastamento").value;
  console.log("NaturezaAfastamento:"+form1Tab1);
  console.log("TipoAfastamento:"+form1Tab2);
  let mapeador1 = {
    "chave_01": document.getElementById("Nome").value,
    "chave_02": document.getElementById("SIAPE").value,
    "chave_03": document.getElementById("Cargo").value,
    "chave_04": document.getElementById("Telefone").value,
    "chave_05": document.getElementById("Email").value,
    "chave_06": document.getElementById("InstituicaoDestino").value,
    "chave_21": document.getElementById("Evento").value,
    "chave_07": document.getElementById("CidadeDestino").value,
    "chave_08": document.getElementById("EstadoDestino").value,
    "chave_09": document.getElementById("DataInicioEvento").value,
    "chave_10": document.getElementById("DataTerminoEvento").value,
    "chave_11": document.getElementById("DataInicioAfastamento").value,
    "chave_12": document.getElementById("DataTerminoAfastamento").value,
    "chave_13": "",
    "chave_14": "",
    "chave_15": "",
    "chave_16": "",
    "chave_17": "",
    "chave_18": "[digite aqui o nome do programa de pós-graduação ou unidade da UFF que concederá bolsa de estudos ou pagamento do curso/mensalidades ou passagens e/ou diárias]",
    "chave_19": "[digite aqui o nome da agência de fomento ou instituição brasileira federal que concederá bolsa de estudos ou pagamento do curso/mensalidades ou passagens e/ou diárias]",
    "chave_20": "[digite aqui o nome da agência de fomento ou instituição brasileira não federal que concederá bolsa de estudos ou pagamento do curso/mensalidades ou passagens e/ou diárias]",
    "chave_tipo_1": "",
    "chave_tipo_2": "",
    "chave_tipo_3": "",
    "chave_tipo_4": "",
    "chave_tipo_5": "",
    "chave_tipo_6": "",
    "chave_tipo_7": "",
    "chave_tipo_8": "",
    "chave_tipo_9": "",
    "chave_22": "", // outro...
  };

  let nomeFinanciador = document.getElementById("NomeFinanciador").value;

  if (form1Tab1 == "CASO_1"){
     mapeador1["chave_13"] = "X";
     mapeador1["chave_18"] = nomeFinanciador;
  } else if (form1Tab1 == "CASO_2") {
     mapeador1["chave_14"] = "X";
     mapeador1["chave_19"] = nomeFinanciador;
  } else if (form1Tab1 == "CASO_3") {
     mapeador1["chave_15"] = "X";
  } else if (form1Tab1 == "CASO_4") {
     mapeador1["chave_16"] = "X";
     mapeador1["chave_20"] = nomeFinanciador;
  } else if (form1Tab1 == "CASO_5") {
     mapeador1["chave_17"] = "X";
  }

  if (form1Tab2 ==  "TIPO_1") {
     mapeador1["chave_tipo_1"] = "X";
  } else if (form1Tab2 == "TIPO_2") {
     mapeador1["chave_tipo_2"] = "X";
  } else if (form1Tab2 == "TIPO_3") {
     mapeador1["chave_tipo_3"] = "X";
  } else if (form1Tab2 == "TIPO_4") {
     mapeador1["chave_tipo_4"] = "X";
  } else if (form1Tab2 == "TIPO_5") {
     mapeador1["chave_tipo_5"] = "X";
  } else if (form1Tab2 == "TIPO_6") {
     mapeador1["chave_tipo_6"] = "X";
  } else if (form1Tab2  == "TIPO_7") {
     mapeador1["chave_tipo_7"] = "X";
  } else if (form1Tab2 == "TIPO_8") {
     mapeador1["chave_tipo_8"] = "X";
     mapeador1["chave_22"] = document.getElementById("Outro").value;
  } else if (form1Tab2 == "TIPO_9") { // Banca Examinadora
     mapeador1["chave_tipo_8"] = "X";
     mapeador1["chave_tipo_9"] = "X";
     mapeador1["chave_22"] = "Banca Examinadora";
  }

  let mapeador2 = {
    "chave_01": document.getElementById("Nome").value,
    "chave_02": document.getElementById("SIAPE").value,
  };

  let mapeador4 = {
    "chave_01": document.getElementById("Nome").value,
    "chave_02": document.getElementById("SIAPE").value,
    "chave_03": document.getElementById("Cargo").value,
    "chave_04": document.getElementById("RG").value,
    "chave_05": document.getElementById("CPF").value,
    "chave_06": document.getElementById("Evento").value,
    "chave_07": document.getElementById("CidadeDestino").value,
    "chave_08": document.getElementById("DataInicioAfastamento").value,  // não é DataInicioEvento
    "chave_09": document.getElementById("DataTerminoAfastamento").value, // não é DataTerminoEvento
    "chave_10": document.getElementById("MotivoRenuncia").value,
    "chave_11": document.getElementById("DataDaSolicitacaoSEI").value,
    "chave_12": document.getElementById("Nome").value
  };

  let mapeador3 = {
    "chave_01": document.getElementById("DataDaSolicitacaoSEI").value,
    "chave_02": document.getElementById("Nome").value,
    "chave_03": document.getElementById("DataDeNascimento").value,
    "chave_04": document.getElementById("CPF").value,
    "chave_05": document.getElementById("RG").value,
    "chave_06": document.getElementById("OrgaoEmisorRG").value,
    "chave_07": document.getElementById("SIAPE").value,
    "chave_08": document.getElementById("Cargo").value,
    "chave_09": document.getElementById("Escolaridade").value,
    "chave_10": document.getElementById("Telefone").value,
    "chave_11": document.getElementById("Telefone").value,
    "chave_12": document.getElementById("Email").value,
    "chave_13": document.getElementById("NomeENumeroDoBanco").value,
    "chave_14": document.getElementById("Agencia").value,
    "chave_15": document.getElementById("ContaCorrente").value,
    "chave_16": document.getElementById("DV").value,
    "chave_17": document.getElementById("LocalOrigem").value,
    "chave_18": document.getElementById("DataInicioAfastamento").value,
    "chave_19": document.getElementById("CidadeDestino").value,
    "chave_20": document.getElementById("MeioDeTransporteIda").value,
    "chave_21": document.getElementById("CidadeDestino").value,
    "chave_22": document.getElementById("DataVoltaEvento").value,
    "chave_23": document.getElementById("LocalOrigem").value,
    "chave_24": document.getElementById("MeioDeTransporteVolta").value,
    "chave_25": document.getElementById("DataInicioEvento").value,
    "chave_26": document.getElementById("HoraInicioEvento").value,
    "chave_27": document.getElementById("DataTerminoEvento").value,
    "chave_28": document.getElementById("HoraTerminoEvento").value,
    "chave_29": document.getElementById("DescricaoMotivoViagem").value,
    "chave_30": document.getElementById("NumeroProcessoSEI").value,
    "chave_31": document.getElementById("JustificativaDiariasPassagens").value,
    "chave_32": document.getElementById("DataDaSolicitacaoSEI").value,
    "chave_33": document.getElementById("Nome").value,
    "chave_tipo_6":  mapeador1["chave_tipo_6"],
    "chave_tipo_7":  mapeador1["chave_tipo_7"],
    "chave_tipo_8":  mapeador1["chave_tipo_8"],
    "chave_tipo_9":  mapeador1["chave_tipo_9"],
    "chave_34": mapeador1["chave_22"], // Outro
  };
  if (form1Tab2 == "TIPO_9") {
     // Se banca examinadora, tirar do 'outro' no form3
     mapeador3["chave_tipo_8"] = ""
     mapeador3["chave_34"] = ""
  }

  const templates = ["oform-1.htm","oform-2.htm","oform-3.htm","oform-4.htm"];
  const outputs   = ["nform-1.htm","nform-2.htm","nform-3.htm","nform-4.htm"];

  // === 3. Processa os templates ===
  for (let i = 0; i < templates.length; i++) {
    try {
        console.log("loading "+templates[i]);

        /*
      const res = await fetch(templates[i]);
      let html = await res.text();

      // substitui todas as chaves do mapeador correspondente
      for (const [key, value] of Object.entries(omapeador[i])) {
        html = html.replaceAll(key, value ?? "");
      }

      */
      const res = await fetch(templates[i]);
      let arrayBuffer = await res.arrayBuffer();
      const decoder = new TextDecoder("iso-8859-1");
      // const html = decoder.decode(arrayBuffer);
      let html = decoder.decode(arrayBuffer);

// create a typed array view over the ArrayBuffer
const bytes = new Uint8Array(arrayBuffer);

// log the first 50 bytes
// console.log(bytes.slice(0, 50));

      // gera download

      let myMap = null;
      if (i==0)
        myMap = mapeador1;
      else if(i==1)
        myMap = mapeador2;
      else if(i==2)
        myMap = mapeador3;
      else if(i==3)
        myMap = mapeador4;
      // atualiza dados no documento
      for (const [key, value] of Object.entries(myMap)) {
        arrayBuffer = replaceBytes(new Uint8Array(arrayBuffer), key, value);
      }

const blob = new Blob([arrayBuffer], { type: "text/html" });
const url = URL.createObjectURL(blob);
const a = document.createElement("a");
a.href = url;
a.download = outputs[i];
a.click();
URL.revokeObjectURL(url);

    } catch (err) {
      console.error("Erro ao processar " + templates[i], err);
    }
  }

  document.getElementById("status").innerText = "Arquivos gerados!";
});

  </script>
</body>
</html>
